<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/sendMail.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/sendMail.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const ejs = require("ejs");
const nodeMailer = require("nodemailer");
const path = require("path");
require("dotenv").config();
const AppError = require("./errorsHandler");
const fs = require("fs");
/**
 *
 * @param {Object} message {userEmail,subject,text,type,templateParams}
 * @description send email message to user email by given message object
 */
exports.sendEmailMessage = async (message) => {
  // create reusable transporter object using the default SMTP transport
  let transporter = nodeMailer.createTransport({
    service: "SendGrid",
    host: process.env.SENDGIRD_HOST,
    port: process.env.SENDGRID_PORT,
    auth: {
      user: process.env.SENDGRID_USERNAME,
      pass: process.env.SENDGRID_PASSWORD,
    },
  });

  // send mail with defined transport object
  const messageUrl =
    process.env.ENVIRONMENT === "development"
      ? `http://localhost:${process.env.PORT}/api/v1/users/${message.url}/${message.userID}`
      : "";
  const templatePath = path.join(
    __dirname,
    `../templates/${
      message.type === "accountVerification"
        ? "verifyAccount.ejs"
        : "resetPassword.ejs"
    }`
  );
  message.url = messageUrl;
  // Read ejs email template
  const source = fs.readFileSync(templatePath, "utf-8").toString();
  const htmlTemplate = ejs.render(source, { message });

  // Send an email with user data and email template
  try {
    let info = await transporter.sendMail({
      from: process.env.EMAIL_ADDRESS, // sender address
      to: `${message.userEmail}`, // list of receivers
      subject: `"${message.subject}"`, // Subject line
      text: `"${message.text}"`, // plain text body
      html: htmlTemplate, // html body
    });

    //console.log("Message sent: %s", info.messageId);
    // Message sent: &lt;b658f8ca-6296-ccf4-8306-87d57a0b4321@example.com>

    // Preview only available when sending through an Ethereal account
    //console.log("Preview URL: %s", nodeMailer.getTestMessageUrl(info));
  } catch (error) {
    let errorApp = new AppError(error.message, 403);
    console.error("âš¡ ", errorApp.message);
  }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-controllers_flashCardsController.html">controllers/flashCardsController</a></li><li><a href="module-controllers_gamesController.html">controllers/gamesController</a></li><li><a href="module-controllers_usersController.html">controllers/usersController</a></li></ul><h3>Classes</h3><ul><li><a href="AppError.html">AppError</a></li></ul><h3>Global</h3><ul><li><a href="global.html#reminder">reminder</a></li><li><a href="global.html#routes">routes</a></li><li><a href="global.html#sendEmailMessage">sendEmailMessage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Wed Mar 30 2022 09:37:21 GMT+0200 (Central Africa Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
